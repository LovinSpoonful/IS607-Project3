---
title: "IS607 Project 3"
author: "Rob, Armenoush, Keith, Dan B, Aadi" 
date: "March 16, 2016"
output: html_document
---


```

sqlUpdate(channel, dat, tablename = NULL, index = NULL, verbose = FALSE, test = FALSE, nastring = NULL, fast = TRUE)

df <- sqlQuery(db,"SELECT * FROM tbl_import", stringsAsFactors = FALSE)  
print(df)

```



```{r}

# Establish connection to the database
library(RODBC)
cnString <- "MySQL_ANSI;SERVER=localhost;DATABASE=skill;UID=root;PASSWORD=CUNYRBridge4!;OPTION=3;"
db <- odbcConnect(cnString, case="nochange")

#manually input the list of csv files on github
sources <- c("https://raw.githubusercontent.com/LovinSpoonful/IS607-Project3/39c575afb60c2ca7d309bb1bdc522b6135df85a2/skills2010.csv",
             "https://raw.githubusercontent.com/LovinSpoonful/IS607-Project3/39c575afb60c2ca7d309bb1bdc522b6135df85a2/skills2013.csv",
             "https://raw.githubusercontent.com/LovinSpoonful/IS607-Project3/39c575afb60c2ca7d309bb1bdc522b6135df85a2/skills2014.csv")

```




```{r}

# Import all the source data into the database

sqlClear(db, "tbl_source", errors = TRUE) # truncate the data sources table

# Loop through every source data file
for (i in 1:length(sources)){

  #create a record of the source in the database
  dat <- read.csv(file = sources[i], header=FALSE, sep=",") 
  source_id <- i
  source_name <- as.character(dat[1,1])  # get the source name from the top row of the data file
  source_url <- as.character(dat[2,1])   # get the source URL from 2nd row
  sSQL <- paste("INSERT INTO tbl_source VALUES (", source_id, ", '", gsub(" ", "_", source_name), "', '", source_name, "', '", source_url, "')",   sep = "", collapse = NULL)  # write this information into the sources table
  sqlQuery(db,sSQL)

  #set the column names and remove the header lines
  n <- unlist(dat[3,])
  names(dat) = n  #
  dat <- dat[-1:-3,]

  #export all the data for this source into the database (the Import table)
  source_id <- rep(i,nrow(dat)) # create a column to show which data set these samples came from
  dat <- data.frame(source_id,dat) # add that column to the front of the dataframe
  sqlSave(db, dat, tablename = "tbl_import", rownames=FALSE, append=TRUE) # write the dataframe to the mySQL table

}

```


